### Лабораторная работа 3: Настройка CI/CD

#### Введение

Для этой лабораторной работы мы создали простой пет-проект, состоящий из веб-сервера и Flask-приложения. Наша цель — научиться настраивать CI/CD, а затем проанализировать и исправить ошибки, связанные с плохими практиками. Мы начали с создания рабочего CI/CD файла, содержащего как минимум пять "bad practices". Далее мы переписали этот файл, исправив плохие практики в соответствии с best practices. 

Файл с конфигурацией CI/CD расположен в директории .github/workflows под именем main.yml.

#### Шаг 1: Написание "плохого" CI/CD файла

Первоначальный файл CI/CD был разработан с целью обеспечения работы, но без учета стандартов качества и лучших практик. В этом файле намеренно использовались следующие "bad practices":

1. Использование последней версии ОС (`runs-on: ubuntu-latest`)  
   _Почему это плохо:_ Использование последней версии Ubuntu без фиксации на конкретной версии может привести к нестабильности в процессе сборки и деплоя, так как обновления операционной системы могут повлиять на работу.  
   _Исправление:_ В исправленном файле мы зафиксировали версию ОС на ubuntu-20.04, что обеспечило стабильность окружения для CI/CD.

2. Неэффективная установка Docker Compose через `apt-get`  
   _Почему это плохо:_ Каждый раз при сборке и деплое Docker Compose устанавливается заново через apt-get. Это замедляет выполнение пайплайна и увеличивает время работы CI.  
   _Исправление:_ Мы заменили установку Docker Compose на использование готового действия docker/compose-action@v2. Это ускорило выполнение шагов и уменьшило время на установку.

3. Отсутствие кэширования Docker-слоев  
   _Почему это плохо:_ Полная пересборка контейнеров каждый раз занимает много времени, особенно при большом количестве зависимостей.  
   _Исправление:_ Добавили шаг кэширования Docker-слоев с использованием actions/cache@v3. Это позволило значительно ускорить процесс сборки за счет использования ранее сохраненных слоев.

4. Деплой через `docker-compose down` перед `docker-compose up`  
   _Почему это плохо:_ Остановка контейнеров перед повторным запуском может привести к кратковременной недоступности сервиса, что негативно сказывается на пользователях.  
   _Исправление:_ В исправленном файле мы заменили команду на docker-compose up -d --build --no-deps, что позволило перезапустить контейнеры без их остановки и минимизировать простой.

5. Отсутствие кэширования зависимостей в тестах  
   _Почему это плохо:_ Установка зависимостей каждый раз перед тестированием замедляет выполнение CI/CD процесса.  
   _Исправление:_ В новом файле добавлено кэширование зависимостей с использованием actions/cache@v3 для ускорения тестов.

#### Шаг 2: Написание "хорошего" CI/CD файла

После выявления проблем в "плохом" файле мы переписали CI/CD процесс, исправив все плохие практики и применив лучшие решения. Основные улучшения:

- Зафиксировали версию операционной системы для стабильности сборок.
- Использовали Docker Compose Action для ускорения установки.
- Внедрили кэширование Docker-слоев и зависимостей для повышения производительности.
- Изменили процесс деплоя для минимизации времени простоя сервисов.

#### Заключение

В ходе выполнения лабораторной работы мы научились выявлять и исправлять распространенные ошибки при написании CI/CD пайплайнов. После внесения исправлений производительность CI/CD процесса значительно улучшилась за счет уменьшения времени сборки и деплоя, а также повышения стабильности.